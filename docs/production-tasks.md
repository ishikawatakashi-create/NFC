# 本番運用開始までのタスク一覧

**最終更新**: 2025年1月  
**対象**: NFCカード入退室管理システム  
**目的**: 現在の状況から実際の社内運用に向けて必要なタスクの洗い出し

---

## 📋 タスク構造

各タスクは以下の形式で記載：
- **親タスク**: 大きなカテゴリ
  - **子タスク**: 具体的な作業項目

---

## 🔒 1. セキュリティ・認証の確認・強化

### 1.1 認証・認可の動作確認
- [ ] 管理者ログイン機能の動作確認
- [ ] 管理者ログアウト機能の動作確認
- [ ] 未認証ユーザーが管理画面にアクセスできないことを確認
- [ ] セッションの有効期限が適切か確認

### 1.2 APIエンドポイントの認証チェック実装・確認
- [ ] `/api/students` に認証チェックが実装されているか確認・実装
- [ ] `/api/cards/*` に認証チェックが実装されているか確認・実装
- [ ] `/api/access-logs` に認証チェックが実装されているか確認・実装
- [ ] `/api/admin/*` に認証チェックが実装されているか確認・実装
- [ ] `/api/point-settings` に認証チェックが実装されているか確認・実装
- [ ] キオスク画面用API（`/api/cards/verify`）は認証不要で正しいか確認

### 1.3 環境変数のセキュリティ確認
- [ ] `.env.local` がGitにコミットされていないか確認
- [ ] `.gitignore` に `.env*` が含まれているか確認
- [ ] 本番環境（Vercel）の環境変数が正しく設定されているか確認
- [ ] 環境変数が「Production」環境として設定されているか確認

### 1.4 データベースセキュリティの確認
- [ ] RLS（Row Level Security）がすべてのテーブルで有効化されているか確認
- [ ] サービスロールキーがクライアント側に露出していないか確認
- [ ] データベース接続が暗号化されているか確認（Supabaseは自動対応）

---

## 🚀 2. 本番環境の設定・確認

### 2.1 Vercel本番環境の設定確認
- [ ] 本番環境（Production）としてデプロイされているか確認
- [ ] 環境変数が「Production」環境として設定されているか確認
- [ ] ビルドコマンドが正しく設定されているか確認
- [ ] Node.jsバージョンが適切か確認（`package.json`の`engines`を確認）

### 2.2 環境変数の最終確認
- [ ] `NEXT_PUBLIC_SUPABASE_URL` が設定されているか確認
- [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY` が設定されているか確認
- [ ] `SUPABASE_SERVICE_ROLE_KEY` が設定されているか確認
- [ ] `SITE_ID` が設定されているか確認
- [ ] `LINE_CHANNEL_ACCESS_TOKEN` が設定されているか確認（LINE通知を使用する場合）
- [ ] `/envcheck` ページで環境変数が正しく読み込まれているか確認

### 2.3 データベース設定の確認
- [ ] Supabaseプロジェクトが本番環境用に設定されているか確認
- [ ] データベースのバックアップ設定を確認
- [ ] 接続プールの設定を確認（大量アクセス時）

### 2.4 カスタムドメインの設定（任意）
- [ ] カスタムドメインが必要か判断
- [ ] カスタムドメインの設定（必要な場合）
- [ ] DNS設定の確認（カスタムドメインを使用する場合）

---

## 🧪 3. 機能テスト・検証

### 3.1 認証機能のテスト
- [ ] 管理者ログインのテスト
- [ ] 管理者ログアウトのテスト
- [ ] 未認証ユーザーのアクセス拒否テスト

### 3.2 生徒管理機能のテスト
- [ ] 生徒の追加テスト
- [ ] 生徒の編集テスト
- [ ] 生徒の削除テスト
- [ ] 生徒一覧の表示テスト
- [ ] 生徒詳細の表示テスト
- [ ] CSV一括登録のテスト

### 3.3 NFCカード管理機能のテスト
- [ ] カードトークンの発行テスト
- [ ] カードへのトークン書き込みテスト（Web NFC）
- [ ] カードの検証テスト（入室・退室）
- [ ] カードの無効化テスト
- [ ] カード登録の削除テスト

### 3.4 入退室管理機能のテスト
- [ ] 入室記録の作成テスト
- [ ] 退室記録の作成テスト
- [ ] 入退室ログの表示テスト
- [ ] 入退室ログのフィルタリングテスト
- [ ] 入退室ログのCSV出力テスト
- [ ] 入退室ログの訂正テスト

### 3.5 LINE通知機能のテスト
- [ ] 入室時のLINE通知送信テスト
- [ ] 退室時のLINE通知送信テスト
- [ ] 通知テンプレートの適用テスト
- [ ] 通知履歴の確認テスト

### 3.6 設定機能のテスト
- [ ] 通知テンプレートの保存テスト
- [ ] 通知テンプレートの読み込みテスト
- [ ] ポイント設定の保存テスト（実装されている場合）

### 3.7 セキュリティテスト
- [ ] 認証バイパスの試行テスト
- [ ] SQLインジェクション対策の確認
- [ ] XSS対策の確認
- [ ] CSRF対策の確認

### 3.8 負荷テスト（簡易版）
- [ ] 想定同時アクセス数での動作確認
- [ ] 複数のキオスク端末からの同時アクセス確認
- [ ] 大量データ時のパフォーマンス確認（生徒数100人、500人、1000人時）
- [ ] 入退室ログが大量にある場合の動作確認
- [ ] APIレスポンス時間の確認

---

## 🛠️ 4. 未実装機能の実装

### 4.1 ページネーションの実装
- [ ] 生徒一覧にページネーションを実装（1ページ50件程度）
- [ ] 入退室ログ一覧にページネーションを実装（1ページ100件程度）
- [ ] APIに`page`と`limit`パラメータを追加
- [ ] フロントエンドにページネーションUIを追加

### 4.2 エラーハンドリングの改善
- [ ] 404エラーページの作成（`app/not-found.tsx`）
- [ ] 500エラーページの作成（`app/error.tsx`）
- [ ] 技術的なエラーメッセージをユーザー向けに変換
- [ ] エラーログはサーバー側に記録し、ユーザーには簡潔なメッセージを表示
- [ ] ネットワークエラー時のリトライ機能の実装（任意）

### 4.3 ローディング状態の改善
- [ ] スケルトンローダーの追加
- [ ] ローディングインジケーターの統一
- [ ] プログレスバーの追加（長時間処理の場合）

---

## 📊 5. 監視・ログ・バックアップ

### 5.1 監視ツールの設定
- [ ] Vercel Analyticsの有効化確認（既に導入済み）
- [ ] エラー監視ツール（Sentry等）の導入検討
- [ ] パフォーマンス監視の設定

### 5.2 ログ管理の整備
- [ ] アクセスログの確認方法の文書化
- [ ] エラーログの確認方法の文書化
- [ ] ログの保持期間の設定

### 5.3 バックアップ・復元の設定
- [ ] Supabaseの自動バックアップ設定を確認
- [ ] 手動バックアップ手順の文書化
- [ ] 復元手順の文書化
- [ ] Gitリポジトリのバックアップ確認
- [ ] リリースタグの作成方法を文書化

---

## ⚡ 6. パフォーマンス最適化

### 6.1 ビルド・バンドル最適化
- [ ] ビルド時間の確認
- [ ] バンドルサイズの確認
- [ ] 不要な依存関係の削除

### 6.2 ページ読み込み速度の最適化
- [ ] Lighthouseでパフォーマンススコアを確認
- [ ] 画像最適化の確認
- [ ] コード分割の確認

### 6.3 データ取得の最適化
- [ ] 不要なデータ取得の削減
- [ ] キャッシュ戦略の検討
- [ ] ログ取得の上限を設定可能にする（現在1000件固定）

---

## 📚 7. ドキュメント整備

### 7.1 社内向けマニュアルの作成
- [ ] 管理者向けマニュアルの作成
  - ログイン方法
  - 生徒管理の方法
  - NFCカード登録の方法
  - 入退室ログの確認方法
  - 設定の変更方法
- [ ] キオスク画面の使い方の文書化
  - 入室画面・退室画面の使い方
  - トラブル時の対処法
- [ ] よくある質問（FAQ）の整備（社内スタッフ向け）

### 7.2 技術ドキュメントの整備
- [ ] API仕様書の作成（任意）
- [ ] データベーススキーマドキュメントの作成（任意）
- [ ] デプロイ手順書の確認・更新

---

## 🎓 8. 社内サポート体制の整備

### 8.1 サポートフローの整備
- [ ] 社内での問い合わせ窓口の設定（担当者を決める）
- [ ] よくある質問への回答準備
- [ ] エスカレーション手順の整備（技術的な問題が発生した場合）

### 8.2 メンテナンス・アップデート管理
- [ ] メンテナンス時の通知方法の検討（社内スタッフへの連絡方法）
- [ ] 保護者への通知が必要な場合の方法（LINE通知等）
- [ ] 変更履歴の記録方法（社内共有用）
- [ ] 機能追加時の社内通知方法

---

## 🚦 9. 段階的な運用開始

### 9.1 テスト運用の準備
- [ ] テスト運用の期間を決定（1-2週間推奨）
- [ ] テスト運用の参加者を決定（社内スタッフのみ）
- [ ] テスト運用の目標を設定

### 9.2 テスト運用の実施
- [ ] 社内スタッフのみでテスト運用を開始
- [ ] 実際の入退室記録の確認
- [ ] LINE通知の動作確認
- [ ] 問題点の洗い出しと修正

### 9.3 限定運用の準備
- [ ] 限定運用の期間を決定（1週間推奨）
- [ ] 限定運用の対象を決定（一部の生徒のみ）
- [ ] 保護者へのLINE通知開始の準備

### 9.4 限定運用の実施
- [ ] 一部の生徒のみで運用開始
- [ ] 保護者へのLINE通知開始
- [ ] フィードバック収集

### 9.5 全面運用開始
- [ ] すべての生徒で運用開始
- [ ] 本番運用の開始

---

## 📝 タスク優先度

### 🔴 最優先（本番運用開始前に必須）
1. **セキュリティ・認証の確認・強化**（1.1〜1.4）
2. **本番環境の設定・確認**（2.1〜2.3）
3. **機能テスト・検証**（3.1〜3.6）

### 🟡 高優先度（本番運用開始前に推奨）
4. **未実装機能の実装**（4.1〜4.3）
5. **監視・ログ・バックアップ**（5.1〜5.3）

### 🟢 中優先度（運用開始後も継続的に実施）
6. **パフォーマンス最適化**（6.1〜6.3）
7. **ドキュメント整備**（7.1〜7.2）
8. **社内サポート体制の整備**（8.1〜8.2）

### 🔵 運用開始時
9. **段階的な運用開始**（9.1〜9.5）

---

## 📊 タスク進捗管理

### 進捗確認方法
- [ ] 各親タスクの完了率を確認
- [ ] 子タスクの完了状況を確認
- [ ] ブロッカー（進行を妨げている問題）の確認

### 完了基準
- 各子タスクにチェックボックスを付けて、完了したらチェック
- 親タスクはすべての子タスクが完了したら完了とする

---

## 🎯 次のステップ

1. **最優先タスクの実施**: セキュリティ・認証の確認・強化から開始
2. **本番環境の設定**: VercelのProduction環境設定を確認
3. **機能テスト**: すべての機能が正常に動作することを確認
4. **段階的運用開始**: テスト運用 → 限定運用 → 全面運用

---

**最終更新**: 2025年1月  
**バージョン**: 1.0.0




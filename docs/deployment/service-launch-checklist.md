# サービス公開チェックリスト（自社内利用版）

**最終更新**: 2025年1月  
**対象**: NFCカード入退室管理システム  
**利用形態**: 自社内利用（自社で運営している子どもの教育事業での入退室管理）

---

## 📋 目次

1. [概要](#概要)
2. [Phase 1: セキュリティ・法的要件（必須）](#phase-1-セキュリティ法的要件必須)
3. [Phase 2: 技術的準備（必須）](#phase-2-技術的準備必須)
4. [Phase 3: 運用準備（推奨）](#phase-3-運用準備推奨)
5. [保護者への説明・同意取得](#保護者への説明同意取得)
6. [本番運用開始](#本番運用開始)
7. [運用後のメンテナンス](#運用後のメンテナンス)
8. [トラブルシューティング](#トラブルシューティング)

---

## 概要

このドキュメントは、開発環境とデプロイ環境で動作しているNFCカード入退室管理システムを、**自社内での教育事業の入退室管理**として本番運用を開始するために必要な手順をまとめたものです。

### 利用形態

- **利用範囲**: 自社内のみ（一般公開なし）
- **利用目的**: 自社で運営している子どもの教育事業での入退室管理
- **利用者**: 社内スタッフ（管理者）、保護者（LINE通知受信）

### 現在の状態

- ✅ Vercelにデプロイ済み（`nfc-toukalab.vercel.app`）
- ✅ 管理者認証機能実装済み
- ✅ LINE通知機能実装済み
- ✅ RLS（Row Level Security）設定済み
- ✅ 基本的な機能は動作中

### 本番運用開始までの流れ

```
Phase 1: セキュリティ・法的要件（1週間）
  ↓
Phase 2: 技術的準備（3-5日）
  ↓
Phase 3: 運用準備（1週間）
  ↓
保護者への説明・同意取得（1週間）
  ↓
本番運用開始
```

---

## Phase 1: セキュリティ・法的要件（必須）

### 🔒 1.1 セキュリティ強化

#### ✅ 認証・認可の確認
- [ ] 管理者認証が正しく動作しているか確認
- [ ] APIエンドポイントに認証チェックが実装されているか確認
- [ ] セッション管理が適切に実装されているか確認
- [ ] パスワードポリシーが適切か確認（最小文字数、複雑さ）

#### ✅ データ保護
- [ ] 環境変数がGitにコミットされていないか確認
- [ ] 本番環境の環境変数が正しく設定されているか確認
- [ ] データベース接続が暗号化されているか確認（Supabaseは自動対応）
- [ ] RLS（Row Level Security）がすべてのテーブルで有効化されているか確認

#### ✅ セキュリティヘッダー
- [ ] HTTPSが強制されているか確認（Vercelは自動対応）
- [ ] CORS設定が適切か確認
- [ ] セキュリティヘッダー（CSP、X-Frame-Options等）の設定を検討

#### ✅ レート制限（自社内利用向け簡易版）
- [ ] ログイン試行回数制限の検討（社内利用のため、厳密なレート制限は任意）
- [ ] アクセスログの監視方法の確認

**参考ドキュメント**: 
- `docs/admin-authentication-setup.md`
- `docs/rls-setup-guide.md`

---

### 📜 1.2 法的要件（自社内利用向け簡易版）

#### ✅ プライバシーポリシー（簡易版）
- [ ] **プライバシーポリシー**の作成（社内利用向け簡易版）
  - 個人情報の収集目的（入退室管理、保護者への通知）
  - 個人情報の取り扱い方法（社内のみ、第三者提供なし）
  - 個人情報の開示・訂正・削除手続き（保護者からの要請に対応）
  - データの保存期間（退会後○年間等）
- [ ] プライバシーポリシーを管理画面に掲載（任意）
  - `/admin/privacy` ページの作成（社内スタッフ向け）
  - 保護者向けには別途説明資料を用意

#### ✅ 個人情報保護法対応
- [ ] **保護者への説明資料**の作成
  - 入退室管理システムの利用目的
  - 収集する個人情報の内容（生徒名、入退室時刻、LINE通知）
  - 個人情報の取り扱い方法
  - 同意取得の方法（口頭説明＋同意書、または説明文書の配布）
- [ ] 個人情報の削除・訂正手続きの文書化
  - 保護者からの要請時の対応フロー
- [ ] データ保持期間の設定
  - 退会後のデータ保持期間の決定（例：1年間）
  - 保持期間経過後の削除手順

**注意**: 自社内利用のため、一般公開サービスほど厳密な法的文書は不要ですが、**個人情報保護法への対応は必須**です。

**参考**: 
- [個人情報保護委員会](https://www.ppc.go.jp/)
- [文部科学省：学校における個人情報保護](https://www.mext.go.jp/)

---

## Phase 2: 技術的準備（必須）

### 🚀 2.1 本番環境の最終確認

#### ✅ デプロイ設定
- [ ] Vercelの本番環境設定を確認
- [ ] カスタムドメインの設定（任意）
  - 独自ドメインの取得
  - DNS設定
  - SSL証明書の確認（Vercelは自動対応）
- [ ] 環境変数の最終確認
  - `NEXT_PUBLIC_SUPABASE_URL`
  - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
  - `SUPABASE_SERVICE_ROLE_KEY`
  - `SITE_ID`
  - `LINE_CHANNEL_ACCESS_TOKEN`

#### ✅ パフォーマンス最適化
- [ ] ビルド時間の確認
- [ ] ページ読み込み速度の確認（Lighthouse）
- [ ] 画像最適化の確認
- [ ] バンドルサイズの確認

#### ✅ エラーハンドリング
- [ ] エラーログの収集設定（Sentry等の検討）
- [ ] エラーページ（404、500）のカスタマイズ
- [ ] ユーザーフレンドリーなエラーメッセージの確認

**参考ドキュメント**: 
- `docs/vercel-deployment-guide.md`

---

### 🧪 2.2 テスト

#### ✅ 機能テスト
- [ ] 管理者ログイン・ログアウト
- [ ] 生徒管理（追加・編集・削除）
- [ ] NFCカード登録・検証
- [ ] 入退室記録
- [ ] LINE通知送信
- [ ] 設定の保存・読み込み

#### ✅ 負荷テスト（自社内利用向け簡易版）
- [ ] 想定同時アクセス数の確認（社内スタッフ数、保護者数）
- [ ] 大量データ時のパフォーマンス確認（生徒数が増えた場合を想定）
- [ ] APIレスポンス時間の確認（実用上問題ない速度か）

#### ✅ セキュリティテスト
- [ ] 認証バイパスの試行
- [ ] SQLインジェクション対策の確認
- [ ] XSS対策の確認
- [ ] CSRF対策の確認

---

### 📊 2.3 監視・ログ設定

#### ✅ 監視ツールの導入（自社内利用向け簡易版）
- [ ] Vercel Analyticsの有効化（既に導入済み）
- [ ] エラー監視の確認方法（Vercelログで十分な場合が多い）
- [ ] パフォーマンス監視（Vercel Analyticsで十分な場合が多い）

#### ✅ ログ管理
- [ ] アクセスログの確認方法の文書化
- [ ] エラーログの確認方法の文書化
- [ ] ログの保持期間の設定

**参考ドキュメント**: 
- `docs/vercel-logs-guide.md`

---

### 🔄 2.4 バックアップ・復元

#### ✅ データベースバックアップ
- [ ] Supabaseの自動バックアップ設定を確認
- [ ] 手動バックアップ手順の文書化
- [ ] 復元手順の文書化

#### ✅ コードバックアップ
- [ ] Gitリポジトリのバックアップ
- [ ] リリースタグの作成

---

## Phase 3: 運用準備（推奨）

### 📚 3.1 ドキュメント整備

#### ✅ 社内向けマニュアル
- [ ] **管理者向けマニュアル**の作成
  - ログイン方法
  - 生徒管理の方法
  - NFCカード登録の方法
  - 入退室ログの確認方法
  - 設定の変更方法
- [ ] **キオスク画面の使い方**の文書化
  - 入室画面・退室画面の使い方
  - トラブル時の対処法
- [ ] **よくある質問（FAQ）**の整備（社内スタッフ向け）

**参考ドキュメント**: 
- `docs/client-faq.md`
- `docs/kiosk-screen-guide.md`

---

### 🎓 3.2 社内サポート体制

#### ✅ サポートフロー
- [ ] 社内での問い合わせ窓口の設定（担当者を決める）
- [ ] よくある質問への回答準備
- [ ] エスカレーション手順の整備（技術的な問題が発生した場合）

---

### 🔔 3.3 メンテナンス・アップデート

#### ✅ メンテナンス通知
- [ ] メンテナンス時の通知方法の検討（社内スタッフへの連絡方法）
- [ ] 保護者への通知が必要な場合の方法（LINE通知等）

#### ✅ アップデート管理
- [ ] 変更履歴の記録方法（社内共有用）
- [ ] 機能追加時の社内通知方法

---

## 保護者への説明・同意取得

### 📋 4.1 説明資料の作成

#### ✅ 保護者向け説明資料
- [ ] **入退室管理システムの説明**
  - システムの目的（安全な入退室管理、保護者への通知）
  - 利用する技術（NFCカード、LINE通知）
  - 収集する個人情報の内容
- [ ] **個人情報の取り扱いについて**
  - 個人情報の利用目的
  - 個人情報の保存期間
  - 個人情報の開示・訂正・削除の手続き
- [ ] **LINE通知について**
  - LINE通知の内容（入室・退室時刻）
  - LINE通知の停止方法
  - 個人情報の取り扱い

#### ✅ 同意取得の方法
- [ ] 説明会の実施（任意）
- [ ] 説明文書の配布
- [ ] 同意書の回収（口頭同意でも可、文書化推奨）
- [ ] 同意取得の記録管理

---

### 📝 4.2 保護者向けマニュアル

#### ✅ LINE通知の使い方
- [ ] LINE通知の受信方法の説明
- [ ] LINE通知の内容の説明
- [ ] 通知が届かない場合の対処法

**参考ドキュメント**: 
- `docs/client-faq.md`（保護者向けFAQとして活用可能）

---

## 本番運用開始

### 🚀 5.1 段階的な運用開始

#### ✅ テスト運用（1-2週間）
- [ ] 社内スタッフのみでテスト運用
- [ ] 実際の入退室記録の確認
- [ ] LINE通知の動作確認
- [ ] 問題点の洗い出しと修正

#### ✅ 限定運用（1週間）
- [ ] 一部の保護者のみにLINE通知を開始
- [ ] 保護者からのフィードバック収集
- [ ] 問題点の修正

#### ✅ 全面運用開始
- [ ] すべての保護者へのLINE通知開始
- [ ] 本番運用の開始

---

## 運用後のメンテナンス

### 📅 定期メンテナンス

#### ✅ 毎日
- [ ] エラーログの確認（Vercelダッシュボード）
- [ ] システムの稼働状況確認

#### ✅ 毎週
- [ ] バックアップの確認（Supabase）
- [ ] 入退室ログの確認
- [ ] LINE通知の動作確認

#### ✅ 毎月
- [ ] データベースの状態確認
- [ ] ログの整理
- [ ] 社内スタッフからのフィードバック確認

---

### 🔄 アップデート

#### ✅ 機能追加
- [ ] 社内スタッフからの要望収集
- [ ] 優先順位の決定
- [ ] 開発・テスト・リリース

#### ✅ セキュリティパッチ
- [ ] 依存関係のアップデート（定期的に）
- [ ] セキュリティ脆弱性の確認
- [ ] パッチの適用

---

## トラブルシューティング

### 🚨 よくある問題

#### 問題1: サービスが応答しない
**原因**: 
- Vercelのデプロイエラー
- Supabase接続エラー
- 環境変数の設定ミス

**対応**:
1. Vercelダッシュボードでデプロイログを確認
2. 環境変数の設定を確認
3. Supabaseの接続状態を確認

#### 問題2: LINE通知が届かない
**原因**:
- LINE Channel Access Tokenの期限切れ
- Webhook設定の不備
- 保護者とLINEアカウントの紐付け不備

**対応**:
1. LINE Developers Consoleでトークンの有効性を確認
2. Webhook URLの設定を確認
3. 保護者とLINEアカウントの紐付けを確認

**参考ドキュメント**: 
- `docs/line-integration-flow.md`
- `docs/line-notification-mechanism-explanation.md`

#### 問題3: NFCカードが読み取れない
**原因**:
- Web NFC APIの対応ブラウザでない
- HTTPS接続でない
- カードの互換性問題

**対応**:
1. Android端末のChromeでアクセスしているか確認
2. HTTPS接続であることを確認
3. カードの互換性を確認

**参考ドキュメント**: 
- `docs/nfc-card-compatibility.md`
- `docs/kiosk-screen-guide.md`

---

## 📝 チェックリストサマリー（自社内利用版）

### 必須項目（本番運用開始前に完了必須）

- [ ] **Phase 1: セキュリティ・法的要件**
  - [ ] 認証・認可の確認
  - [ ] データ保護の確認
  - [ ] プライバシーポリシーの作成（簡易版）
  - [ ] 個人情報保護法対応（保護者への説明資料作成）
- [ ] **Phase 2: 技術的準備**
  - [ ] 本番環境の最終確認
  - [ ] 機能テストの実施
  - [ ] 監視・ログ設定
  - [ ] バックアップ設定
- [ ] **保護者への説明・同意取得**
  - [ ] 説明資料の作成
  - [ ] 同意取得の実施

### 推奨項目（運用開始後も継続的に実施）

- [ ] **Phase 3: 運用準備**
  - [ ] 社内向けマニュアルの整備
  - [ ] サポートフローの整備
- [ ] **運用後のメンテナンス**
  - [ ] 定期メンテナンスの実施
  - [ ] アップデートの管理

---

## 🎯 次のステップ（自社内利用版）

1. **Phase 1の確認**: セキュリティと法的要件を最優先で確認
   - 特に保護者への説明資料の作成が重要
2. **Phase 2の実施**: 技術的な準備を完了
   - テスト運用を実施
3. **保護者への説明**: 説明資料を作成し、同意取得を実施
4. **段階的運用開始**: テスト運用 → 限定運用 → 全面運用

---

## 📚 関連ドキュメント

- `docs/vercel-deployment-guide.md` - デプロイ手順
- `docs/admin-authentication-setup.md` - 認証設定
- `docs/rls-setup-guide.md` - セキュリティ設定
- `docs/line-integration-flow.md` - LINE連携
- `docs/current-status-analysis.md` - 現状分析

---

**最終更新**: 2025年1月  
**バージョン**: 1.0.0


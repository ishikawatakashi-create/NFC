# キオスク画面（スマホ端末側）操作ガイド

## 📱 概要

生徒がNFCカードをタッチして入退室を記録するキオスク画面の使い方を説明します。

---

## 🎯 キオスク画面の種類

### 1. 入口側（Entry）
- **URL**: `https://your-domain.com/kiosk/entry`
- **用途**: 入室時にNFCカードをタッチ
- **カラー**: 青系（ブルーグラデーション）

### 2. 出口側（Exit）
- **URL**: `https://your-domain.com/kiosk/exit`
- **用途**: 退室時にNFCカードをタッチ
- **カラー**: オレンジ系（オレンジグラデーション）

---

## 🔧 セットアップ手順

### 1. Android端末の準備

**推奨環境**:
- Android 10 以上
- Google Chrome ブラウザ（最新版）
- NFCが有効になっていること

**NFCの有効化**:
```
設定 → 接続済みのデバイス → 接続の設定 → NFC → オンにする
```

### 2. ブラウザでキオスク画面を開く

**入口側の端末**:
1. Chrome ブラウザを開く
2. `https://your-domain.com/kiosk/entry` にアクセス
3. ブックマークまたはホーム画面に追加
4. 全画面表示モードにする（オプション）

**出口側の端末**:
1. Chrome ブラウザを開く
2. `https://your-domain.com/kiosk/exit` にアクセス
3. ブックマークまたはホーム画面に追加
4. 全画面表示モードにする（オプション）

### 3. 固定設置（推奨）

- タブレットスタンド等で端末を固定
- 充電ケーブルを接続
- 画面が常時オンになるよう設定
- キオスクモードアプリの使用を推奨（例: Kiosk Browser）

---

## 📝 使用方法

### 入室時の流れ

```
1. 生徒が入口のキオスク画面に近づく
   ↓
2. 「カードをタッチ」ボタンをタップ
   ↓
3. 画面に「読み取り中...」と表示される
   ↓
4. NFCカードを端末にタッチ
   ↓
5. 成功すると緑色で「◯◯さんの入室を記録しました」と表示
   ↓
6. 数秒後に自動で初期画面に戻る
```

### 退室時の流れ

```
1. 生徒が出口のキオスク画面に近づく
   ↓
2. 「カードをタッチ」ボタンをタップ
   ↓
3. 画面に「読み取り中...」と表示される
   ↓
4. NFCカードを端末にタッチ
   ↓
5. 成功すると緑色で「◯◯さんの退室を記録しました」と表示
   ↓
6. 数秒後に自動で初期画面に戻る
```

---

## 🎨 画面の見方

### 入口側画面

```
┌─────────────────────────────┐
│      入口側                  │
│ NFCカードをタッチして        │
│ 入室を記録してください       │
├─────────────────────────────┤
│                             │
│        [📱アイコン]          │
│                             │
│   ┌───────────────────┐     │
│   │ カードをタッチ    │     │
│   └───────────────────┘     │
│                             │
├─────────────────────────────┤
│ ✓ 山田太郎さんの入室を       │
│   記録しました。             │
│                             │
│   生徒名: 山田太郎           │
│   トークン: ...a1b2c3d4      │
│   時刻: 2024-01-15 14:30:25 │
└─────────────────────────────┘
```

### 出口側画面

```
┌─────────────────────────────┐
│      出口側                  │
│ NFCカードをタッチして        │
│ 退室を記録してください       │
├─────────────────────────────┤
│                             │
│        [📱アイコン]          │
│                             │
│   ┌───────────────────┐     │
│   │ カードをタッチ    │     │
│   └───────────────────┘     │
│                             │
├─────────────────────────────┤
│ ✓ 田中花子さんの退室を       │
│   記録しました。             │
│                             │
│   生徒名: 田中花子           │
│   トークン: ...x9y8z7w6      │
│   時刻: 2024-01-15 17:45:10 │
└─────────────────────────────┘
```

---

## ⚠️ エラーメッセージ

### 1. "このデバイスはNFCをサポートしていません"

**原因**:
- Android Chrome 以外のブラウザを使用している
- NFCがオフになっている
- iOSデバイスを使用している

**対策**:
- Android端末でChromeブラウザを使用
- 設定でNFCをオンにする

---

### 2. "カードに有効なトークンが書き込まれていません"

**原因**:
- カードにNDEFトークンが書き込まれていない
- 空のNFCカードを使用している

**対策**:
- 管理画面（`/admin/students`）でカード登録を実施
- 生徒の「カード登録」ボタンからNFCカードに書き込む

---

### 3. "無効なカードまたは登録されていないカードです"

**原因**:
- カードが無効化されている
- 別のシステムで使用されていたカード

**対策**:
- 管理画面で再度カード登録を実施

---

### 4. "このカードに紐付けられた生徒が見つかりません"

**原因**:
- カードトークンは有効だが、生徒との紐付けが削除されている

**対策**:
- 管理画面で生徒とカードの紐付けを確認
- 必要に応じて再登録

---

### 5. "◯◯さんは現在休会中です"

**原因**:
- 生徒のステータスが「在籍」以外になっている

**対策**:
- 管理画面で生徒のステータスを「在籍」に変更
- または、該当の生徒に連絡

---

## 🔧 トラブルシューティング

### カードを認識しない

1. **NFCの位置を確認**
   - 端末のNFCセンサーの位置は機種によって異なる
   - 一般的には背面中央または背面上部

2. **カードのタッチ方法**
   - カードを端末にしっかり密着させる
   - 1-2秒静止する
   - 離しすぎず、強く押しすぎない

3. **カードの状態確認**
   - カードが破損していないか
   - 金属製のケースに入っていないか

### 読み取りがタイムアウトする

- 「カードをタッチ」ボタンを押してから10秒以内にタッチする
- タイムアウトした場合は再度ボタンを押す

### 画面がフリーズする

- ブラウザを再読み込み（F5 または更新ボタン）
- それでも直らない場合はブラウザを再起動

---

## 📊 動作フロー（技術詳細）

```
[生徒] カードをタッチ
   ↓
[キオスク画面] NDEFReader.scan() でカードを読み取り
   ↓
[キオスク画面] NDEFメッセージから "iru:card:xxxxx" トークンを抽出
   ↓
[API] POST /api/cards/verify でトークンを検証
   ↓
[DB] card_tokens → student_cards → students を検索
   ↓
[API] 生徒情報とステータスを返す
   ↓
[キオスク画面] 生徒情報を表示
   ↓
[API] POST /api/access-logs で入退室ログを記録
   ↓
[キオスク画面] 成功メッセージを表示
```

---

## 🎬 デモ動画の撮影方法（オプション）

スタッフ向けにデモ動画を撮影する場合：

1. **準備**
   - 登録済みのNFCカード
   - Android端末（画面録画可能な状態）

2. **撮影内容**
   - キオスク画面を開く
   - 「カードをタッチ」ボタンをタップ
   - カードをタッチ
   - 成功メッセージの表示
   - 管理画面でログを確認

3. **編集ポイント**
   - 成功パターンとエラーパターンの両方を収録
   - 字幕でポイントを説明

---

## 📞 サポート

### よくある質問

**Q: カードは何枚まで登録できますか？**
A: 1生徒につき1枚のみです。新しいカードを登録すると、古いカードは自動的に無効化されます。

**Q: カードを紛失した場合は？**
A: 管理画面から該当のカードを無効化し、新しいカードを再登録してください。

**Q: 複数の端末で同時に使えますか？**
A: はい、入口用と出口用で複数の端末を同時に使用できます。

**Q: オフラインでも使えますか？**
A: いいえ、インターネット接続が必要です。

---

## 🔗 関連ドキュメント

- [NFCカード登録機能 実装ガイド](./nfc-card-registration-guide.md)
- [管理画面 操作マニュアル]（未作成）
- [アクセスログ 確認方法]（未作成）

---

**最終更新**: 2024年12月
**バージョン**: 1.0.0







